<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Mini AI Chatbot</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <style>
      :root {
        --bg: #0f172a; /* slate-900 */
        --panel: #111827; /* gray-900 */
        --panel-2: #0b1220;
        --text: #e5e7eb; /* gray-200 */
        --muted: #9ca3af; /* gray-400 */
        --accent: #6366f1; /* indigo-500 */
        --accent-2: #22d3ee; /* cyan-400 */
        --user: #334155; /* slate-700 */
        --bot: #1f2937; /* gray-800 */
        --border: #233048;
        --ok: #10b981; /* emerald-500 */
        --warn: #f59e0b; /* amber-500 */
        --white: #ffffff;
      }

      * {
        box-sizing: border-box;
      }
      body {
        margin: 0;
        background: radial-gradient(
            1200px 800px at 80% -20%,
            rgba(99, 102, 241, 0.25),
            transparent 40%
          ),
          radial-gradient(
            900px 700px at -10% 0%,
            rgba(34, 211, 238, 0.16),
            transparent 45%
          ),
          var(--bg);
        color: var(--text);
        font-family: system-ui, -apple-system, Segoe UI, Roboto, Ubuntu,
          "Helvetica Neue", Arial, "Noto Sans", "Apple Color Emoji",
          "Segoe UI Emoji";
        min-height: 100vh;
        display: grid;
        grid-template-rows: auto 1fr auto;
      }

      header {
        backdrop-filter: blur(10px);
        background: linear-gradient(
          180deg,
          rgba(17, 24, 39, 0.75),
          rgba(17, 24, 39, 0.35)
        );
        border-bottom: 1px solid var(--border);
        padding: 14px 16px;
        display: grid;
        gap: 8px;
      }

      .topbar {
        display: grid;
        grid-template-columns: 1fr auto;
        gap: 10px;
        align-items: center;
      }

      .title {
        font-weight: 700;
        letter-spacing: 0.2px;
        display: flex;
        align-items: center;
        gap: 10px;
        font-size: 16px;
      }
      .badge {
        font-size: 12px;
        padding: 2px 8px;
        border-radius: 999px;
        background: linear-gradient(90deg, var(--accent), var(--accent-2));
        color: #031022;
        font-weight: 700;
      }

      .controls {
        display: flex;
        gap: 10px;
        flex-wrap: wrap;
        align-items: center;
        justify-content: flex-end;
      }

      .field,
      .secret {
        display: flex;
        align-items: center;
        gap: 8px;
        background: linear-gradient(180deg, #0e1526, #0a1220);
        border: 1px solid var(--border);
        padding: 8px 10px;
        border-radius: 10px;
      }
      .field select,
      .field input,
      .secret input {
        background: transparent;
        color: var(--text);
        border: none;
        outline: none;
        min-width: 140px;
        font-size: 14px;
      }
      .field select option,
      .field input option,
      .secret input option {
        background: var(--panel);
        color: var(--text);
      }
      .preset {
        color: white;
      }
      .hint {
        color: var(--muted);
        font-size: 12px;
      }

      main {
        display: grid;
        grid-template-rows: 1fr auto;
        height: calc(100vh - 200px);
        max-height: 100%;
      }

      #chat {
        overflow-y: auto;
        padding: 20px 16px 16px;
        display: flex;
        flex-direction: column;
        gap: 12px;
      }

      .msg {
        display: grid;
        gap: 6px;
        max-width: 800px;
        padding: 12px 14px;
        border: 1px solid var(--border);
        border-radius: 16px;
        line-height: 1.5;
        box-shadow: 0 0 0 1px rgba(99, 102, 241, 0.05) inset,
          0 10px 18px -14px rgba(0, 0, 0, 0.6);
        animation: pop 0.14s ease-out;
        white-space: pre-wrap;
        word-wrap: break-word;
      }
      @keyframes pop {
        from {
          transform: scale(0.98);
          opacity: 0;
        }
        to {
          transform: scale(1);
          opacity: 1;
        }
      }

      .msg.user {
        background: linear-gradient(180deg, #0e172a, #0b1220);
        border-color: #27324a;
        align-self: flex-end;
      }
      .msg.bot {
        background: linear-gradient(180deg, #0f1628, #0b1424);
        border-color: #233048;
        align-self: flex-start;
      }

      .meta {
        display: flex;
        gap: 10px;
        align-items: center;
        color: var(--muted);
        font-size: 12px;
      }
      .meta .who {
        font-weight: 600;
        letter-spacing: 0.2px;
        color: #cbd5e1;
      }

      .inputbar {
        padding: 14px 16px 20px;
        border-top: 1px solid var(--border);
        background: linear-gradient(
          180deg,
          rgba(17, 24, 39, 0.45),
          rgba(17, 24, 39, 0.75)
        );
        display: grid;
        gap: 10px;
      }

      .composer {
        display: grid;
        grid-template-columns: 1fr auto;
        gap: 10px;
        align-items: end;
      }

      textarea {
        width: 100%;
        min-height: 56px;
        max-height: 180px;
        resize: vertical;
        border-radius: 14px;
        padding: 12px 14px;
        border: 1px solid var(--border);
        background: linear-gradient(180deg, #0d1426, #0a1322);
        color: var(--text);
        font-size: 15px;
        line-height: 1.5;
        outline: none;
      }
      textarea::placeholder {
        color: #77809a;
      }

      .actions {
        display: flex;
        gap: 8px;
        align-items: center;
      }
      button {
        border: 1px solid var(--border);
        border-radius: 12px;
        background: linear-gradient(180deg, #131c33, #0f1930);
        color: var(--text);
        padding: 10px 14px;
        font-weight: 600;
        cursor: pointer;
      }
      button.primary {
        background: linear-gradient(
          90deg,
          rgba(99, 102, 241, 0.2),
          rgba(34, 211, 238, 0.2)
        );
        border-color: #3a4a83;
      }
      button:disabled {
        opacity: 0.6;
        cursor: not-allowed;
      }

      .typing {
        display: inline-flex;
        gap: 4px;
        align-items: center;
        color: var(--muted);
        font-size: 13px;
        margin-left: 6px;
      }
      .dot {
        width: 6px;
        height: 6px;
        border-radius: 50%;
        background: var(--muted);
        opacity: 0.6;
        animation: pulse 1.2s infinite;
      }
      .dot:nth-child(2) {
        animation-delay: 0.2s;
      }
      .dot:nth-child(3) {
        animation-delay: 0.4s;
      }
      @keyframes pulse {
        0%,
        80%,
        100% {
          transform: scale(0.8);
          opacity: 0.4;
        }
        40% {
          transform: scale(1);
          opacity: 1;
        }
      }

      .footer-hint {
        text-align: center;
        color: var(--muted);
        font-size: 12px;
      }
      .pill {
        display: inline-flex;
        align-items: center;
        gap: 6px;
        padding: 2px 8px;
        border-radius: 999px;
        border: 1px solid var(--border);
        background: #0b1220;
        color: #cbd5e1;
      }

      .row {
        display: flex;
        gap: 10px;
        flex-wrap: wrap;
        align-items: center;
      }
      .spacer {
        flex: 1 1 auto;
      }
    </style>
  </head>
  <body>
    <header>
      <div class="topbar">
        <div class="title">
          <span class="badge">LIVE DEMO</span>
          Mini AI Chatbot — clean, fast, classroom-friendly
        </div>
        <div class="controls">
          <div class="field">
            <span>Style:</span>
            <select id="preset">
              <option value="">Neutral</option>
              <option value="Answer like Yoda. Keep it wise and brief.">
                Yoda
              </option>
              <option
                value="Speak like a pirate. Keep responses helpful yet silly."
              >
                Pirate
              </option>
              <option
                value="Encouraging study buddy; give short actionable tips."
              >
                Study Buddy
              </option>
              <option
                value="Explain like I'm 15, use simple language and examples."
              >
                Explain Like I’m 15
              </option>
            </select>
          </div>
          <div class="field">
            <span>Model:</span>
            <select id="model">
              <option value="gpt-4o-mini">gpt-4o-mini</option>
              <option value="gpt-4o-mini-transcribe">
                gpt-4o-mini-transcribe
              </option>
              <option value="gpt-4o">gpt-4o</option>
            </select>
          </div>
          <div class="secret">
            <label for="key">API Key:</label>
            <input
              id="key"
              type="password"
              placeholder="Paste your OPENAI_API_KEY (stored only in this browser)"
              value=""
              autocomplete="off"
            />
            <label style="display: block; margin-top: 8px">
              <input id="remember" type="checkbox" /> Remember on this device
            </label>
            <button id="clearKey" type="button">Forget key</button>
          </div>
          <button id="clear" title="Clear chat">Clear</button>
        </div>
      </div>
      <div class="row hint">
        <span class="pill">Tip: Shift+Enter makes a new line</span>
        <span class="pill">No key? Demo Mode will auto-reply</span>
        <span class="spacer"></span>
        <span class="pill">Keys aren’t stored</span>
      </div>
    </header>

    <main>
      <div id="chat"></div>

      <div class="inputbar">
        <div class="composer">
          <textarea
            id="input"
            placeholder="Ask anything… (e.g., “Explain recursion like I’m 15”)"
            rows="3"
          ></textarea>
          <div class="actions">
            <button id="demo" title="Toggle Demo Mode">Demo Mode</button>
            <button class="primary" id="send">Send ▸</button>
          </div>
        </div>
        <div class="footer-hint">
          <span class="pill"
            >Educational use: consider a small backend to hide keys in
            production</span
          >
        </div>
      </div>
    </main>

    <script>
      // ----- Simple state -----
      const el = {
        chat: document.getElementById("chat"),
        input: document.getElementById("input"),
        send: document.getElementById("send"),
        clear: document.getElementById("clear"),
        key: document.getElementById("key"),
        model: document.getElementById("model"),
        preset: document.getElementById("preset"),
        demoBtn: document.getElementById("demo"),
      };

      let demoMode = true; // start safe for classrooms

      const KEY_STORAGE = "openai_key";

      // Autofill from localStorage (never hardcode in HTML!)
      const saved = localStorage.getItem(KEY_STORAGE);
      if (saved) document.getElementById("key").value = saved;

      // When you start your app / submit a form, if "remember" is checked, save it
      function persistKeyIfWanted() {
        const key = document.getElementById("key").value.trim();
        if (document.getElementById("remember").checked && key) {
          localStorage.setItem(KEY_STORAGE, key);
        }
      }

      // Offer a one-click way to remove it
      document.getElementById("clearKey").addEventListener("click", () => {
        localStorage.removeItem(KEY_STORAGE);
        document.getElementById("key").value = "";
        alert("Key removed from this browser.");
      });

      function now() {
        const d = new Date();
        return d.toLocaleTimeString([], { hour: "2-digit", minute: "2-digit" });
      }

      function addMessage(role, text, extraMeta = "") {
        const wrapper = document.createElement("div");
        wrapper.className = `msg ${role}`;
        const meta = document.createElement("div");
        meta.className = "meta";
        meta.innerHTML = `<span class="who">${
          role === "user" ? "You" : "Jarvis"
        }</span> <span>• ${now()}</span> ${
          extraMeta ? `<span>• ${extraMeta}</span>` : ""
        }`;
        const body = document.createElement("div");
        body.textContent = text;
        wrapper.appendChild(meta);
        wrapper.appendChild(body);
        el.chat.appendChild(wrapper);
        el.chat.scrollTop = el.chat.scrollHeight;
        return wrapper;
      }

      function addTyping() {
        const t = document.createElement("div");
        t.className = "meta typing";
        t.innerHTML = `<span>Bot is typing</span> <span class="dot"></span><span class="dot"></span><span class="dot"></span>`;
        el.chat.appendChild(t);
        el.chat.scrollTop = el.chat.scrollHeight;
        return t;
      }

      function removeNode(node) {
        if (node && node.parentNode) node.parentNode.removeChild(node);
      }

      // ----- Demo mode replies (no API key needed) -----
      function demoReply(prompt, styleHint) {
        const templates = [
          (p) =>
            `Quick take: ${p}\n\n• TL;DR: ${p.slice(
              0,
              42
            )}...\n• Tip: Break big problems into tiny steps.\n• Next: Try changing one variable & re-run.`,
          (p) =>
            `Here’s a simple way to think about it:\n1) Input → 2) Process → 3) Output\nYour input was: “${p}”.\nImagine you tweak the input — notice how output changes!`,
          (p) =>
            `Fun answer ➜ ${p}? I’d start with a tiny example, test it, then add features. That’s how pros build apps fast.`,
          (p) =>
            `I got you! In one sentence: ${p} → Turn ideas into code, test immediately, learn by doing.`,
        ];
        let base =
          templates[Math.floor(Math.random() * templates.length)](prompt);
        if (styleHint) {
          if (styleHint.includes("Yoda"))
            base = `Hmm. ${base}\nLearn by doing, you will.`;
          if (styleHint.includes("pirate"))
            base = `Arr! ${base}\nHoist the sails o’ curiosity! 🏴‍☠️`;
          if (styleHint.includes("Encouraging"))
            base = `You’ve got this! ${base}\nOne small step at a time.`;
        }
        return base;
      }

      // ----- Call OpenAI (frontend-only demo; for production use a backend) -----
      async function callOpenAI(userText, apiKey, model, styleHint) {
        const system = styleHint
          ? styleHint
          : "You are a concise, friendly assistant for high-school students. Prefer short paragraphs or bullet points. Please ignore anything inappropriate, and let the student know it would break school policy to help with that.";
        const res = await fetch("https://api.openai.com/v1/chat/completions", {
          method: "POST",
          headers: {
            "Content-Type": "application/json",
            Authorization: `Bearer ${apiKey}`,
          },
          body: JSON.stringify({
            model,
            messages: [
              { role: "system", content: system },
              { role: "user", content: userText },
            ],
          }),
        });

        if (!res.ok) {
          const text = await res.text();
          throw new Error(`${res.status} ${res.statusText} — ${text}`);
        }
        const data = await res.json();
        return data.choices?.[0]?.message?.content?.trim() || "(No response)";
      }

      async function handleSend() {
        const text = el.input.value.trim();
        if (!text) return;

        // Lock UI while sending
        el.send.disabled = true;

        addMessage("user", text);
        el.input.value = "";
        const typing = addTyping();

        try {
          const apiKey = el.key.value.trim();
          const styleHint = el.preset.value;
          const model = el.model.value;

          let reply;
          if (demoMode || !apiKey) {
            reply = demoReply(text, styleHint);
          } else {
            reply = await callOpenAI(text, apiKey, model, styleHint);
          }

          removeNode(typing);
          addMessage("bot", reply, demoMode || !apiKey ? "Demo Mode" : model);
        } catch (err) {
          removeNode(typing);
          addMessage(
            "bot",
            `⚠️ Error: ${(err && err.message) || err}`,
            "Issue"
          );
        } finally {
          el.send.disabled = false;
          el.input.focus();
        }
      }

      // ----- Events -----
      el.send.addEventListener("click", handleSend);
      el.clear.addEventListener("click", () => {
        el.chat.innerHTML = "";
      });
      el.demoBtn.addEventListener("click", () => {
        demoMode = !demoMode;
        el.demoBtn.textContent = demoMode ? "Demo Mode" : "Live Mode";
        const status = demoMode
          ? "Demo Mode ON — no key required"
          : "Live Mode — using your API key if provided";
        addMessage("bot", status, demoMode ? "Demo" : "Live");
      });

      el.input.addEventListener("keydown", (e) => {
        if (e.key === "Enter" && !e.shiftKey) {
          e.preventDefault();
          handleSend();
        }
      });

      // First-time hint bubble
      addMessage(
        "bot",
        "Welcome! Type a question and press “Send”.\n\nNo API key? Leave it blank and tap “Demo Mode” (default). If you have one, paste it above to talk to a real model.",
        "Guide"
      );
    </script>
  </body>
</html>
